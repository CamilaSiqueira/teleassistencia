<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Clientes</title>

        <ui:insert name="commonHeader" > 
            <ui:include src="subtemplate/_commonHeader.xhtml" />
        </ui:insert>
    </h:head>

    <h:body class="newObjectAll">
        <ui:insert name="header" >
            <ui:include src="subtemplate/_header.xhtml" />
        </ui:insert>

        <p:panel id="painelUsuario" header="Usuario"
                 style="margin-bottom:10px;">
            <h:form id="formUsuario">
                <p:growl id="growl" showDetail="true" sticky="true" />
                <h:panelGrid columns="2" cellpadding="10">

                    <h:outputLabel value="Nome:" style="font-weight:bold" />
                    <h:outputLabel value="#{clienteFinalBean.usuarioSelecionado.nome}" />

                    <h:outputLabel value="CPF:" style="font-weight:bold" />
                    <h:outputLabel value="#{clienteFinalBean.usuarioSelecionado.cpf}" />

                    <h:outputLabel value="RG:" style="font-weight:bold" />
                    <h:outputLabel value="#{clienteFinalBean.usuarioSelecionado.rg}" />

                </h:panelGrid>

                <p:commandButton title="Alterar dados do usuário"
                                 icon="ui-icon-pencil" onclick="alterarUsuario.show()" ajax="true" />
                <p:commandButton title="Excluir" icon="ui-icon-trash"
                                 onclick="confirmarExcluirUsuario.show()" ajax="true" />


                <p:dialog header="Alterar dados do Usuário"
                          widgetVar="alterarUsuario" modal="true" showEffect="fade"
                          hideEffect="fade" resizable="false">
                    <h:panelGrid columns="2" cellpadding="5">

                        <h:outputLabel for="nome" value="Nome:" />
                        <p:inputText id="nome"
                                     value="#{clienteFinalBean.usuarioSelecionado.nome}" required="true" />

                        <h:outputLabel for="cpf" value="CPF:" />
                        <p:inputText id="cpf"
                                     value="#{clienteFinalBean.usuarioSelecionado.cpf}" required="true" />

                        <h:outputLabel for="rg" value="RG" />
                        <p:inputText id="rg"
                                     value="#{clienteFinalBean.usuarioSelecionado.rg}" required="true" />


                    </h:panelGrid>

                    <p:commandButton title="Salvar" value="Salvar alterações"
                                     oncomplete="alterarUsuario.hide();"
                                     actionListener="#{clienteFinalBean.alterarUsuario}"
                                     update=":formUsuario" />

                </p:dialog>

            </h:form>

            <p:separator />

            <h:form id="formPulseira">
                <p:panel header="Pulseiras"
                         style="margin-bottom:5px;">

                    <p:dataTable id="tabelaPulseira"
                                 value="#{clienteFinalBean.listaPulseirasExibicao}" var="pulseira">
                        <p:column headerText="Matrícula">
                            <h:outputText value="#{pulseira.idPulseira}" />
                        </p:column>
                        <p:column headerText="Código Identificador">
                            <h:outputText value="#{pulseira.codigoIdentificador}" />
                        </p:column>
                        <p:column headerText="Uso Liberado">
                            <h:outputText value="#{pulseira.status}" />
                        </p:column>
                        <p:column style="width:32px;text-align: center">


                            <p:commandButton title="Excluir associação" icon="ui-icon-trash"
                                             onclick="confirmarExcluirPulseira.show()" ajax="true"  >
                                <f:setPropertyActionListener value="#{pulseira}"
                                                             target="#{clienteFinalBean.pulseiraSelecionada}" />
                            </p:commandButton>

                        </p:column>
                    </p:dataTable>

                    <p:commandButton title="Associar pulseira"
                                     icon="ui-icon-plus" onclick="alterarPulseira.show()" ajax="true" rendered="#{not empty clienteFinalBean.listaPulseirasDisponiveis}"/>


                </p:panel>
            </h:form>

            <script type="text/javascript">
                function handleDrop(event, ui) {
                    var droppedPulseira = ui.draggable;

                    droppedPulseira.fadeOut('fast');
                }
            </script>


            <p:dialog header="Associar Usuário à Pulseiras"
                      widgetVar="alterarPulseira" modal="true" showEffect="fade"
                      hideEffect="fade" resizable="false" closable="false" >



                <h:form id="formDragAndDropPulseira">
                    <p:fieldset id="campoPulseirasDisponiveis" legend="Pulseiras Disponiveis">
                        <p:dataTable id="pulseirasDisponiveis" var="pulseira" value="#{clienteFinalBean.listaPulseirasDisponiveis}">
                            <p:column style="width:20px">
                                <h:outputText id="dragIconPulseira" styleClass="ui-icon ui-icon-arrow-4" />
                                <p:draggable for="dragIconPulseira" revert="true" helper="clone"/>
                            </p:column>

                            <p:column headerText="Id">
                                <h:outputText value="#{pulseira.idPulseira}" />
                            </p:column>

                            <p:column headerText="Código">
                                <h:outputText value="#{pulseira.codigoIdentificador}" />
                            </p:column>

                            <p:column headerText="Uso Liberado">
                                <h:outputText value="#{pulseira.status}" />
                            </p:column>

                        </p:dataTable>
                    </p:fieldset>

                    <p:fieldset id="pulseirasSelecionadas" legend="Pulseiras Selecionadas" style="margin-top:20px">
                        <p:outputPanel id="dropAreaPulseira">
                            <h:outputText value="!!!Solte aqui!!!" rendered="#{empty clienteFinalBean.listaPulseirasSelecionadas}" style="font-size:24px;" />
                            <p:dataTable id="pulseirasSelecionadasTabela" var="pulseira" value="#{clienteFinalBean.listaPulseirasSelecionadas}" rendered="#{not empty clienteFinalBean.listaPulseirasSelecionadas}">
                                <p:column headerText="Id">
                                    <h:outputText value="#{pulseira.idPulseira}" />
                                </p:column>

                                <p:column headerText="Código">
                                    <h:outputText value="#{pulseira.codigoIdentificador}" />
                                </p:column>

                                <p:column headerText="Uso Liberado">
                                    <h:outputText value="#{pulseira.status}" />
                                </p:column>
                            </p:dataTable>
                        </p:outputPanel>
                    </p:fieldset>

                    <p:droppable for="pulseirasSelecionadas" tolerance="touch" activeStyleClass="ui-state-highlight" datasource="pulseirasDisponiveis" onDrop="handleDrop">
                        <p:ajax listener="#{clienteFinalBean.onPulseiraDrop}" update="dropAreaPulseira pulseirasDisponiveis" />
                    </p:droppable>


                    <p:commandButton title="Salvar" value="Associar Pulseiras Selecionadas"
                                     oncomplete="alterarPulseira.hide();"
                                     actionListener="#{clienteFinalBean.associarPulseira}"
                                     update=":formUsuario:growl :formPulseira :formDragAndDropPulseira" ajax="false" />
                    <p:commandButton title="Cancelar" value="Cancelar associação"
                                     oncomplete="alterarPulseira.hide();"
                                     actionListener="#{clienteFinalBean.preparaDialogPulseiras}"
                                     update=":formUsuario:growl :formPulseira :formDragAndDropPulseira"   ajax="false" />

                </h:form> 
            </p:dialog>




            <p:separator />

            <h:form id="formPrestador">
                <p:panel header="Prestadores de Socorro"
                         style="margin-bottom:5px;">


                    <p:outputPanel id="painelTabelaPrestadores">

                        <p:dataTable id="tabelaPrestadores"
                                     value="#{clienteFinalBean.listaPrestadoresExibicao}" var="prestador">
                            <p:column headerText="Matrícula">
                                <h:outputText value="#{prestador.idPrestadorSocorro}" />
                            </p:column>
                            <p:column headerText="Nome">
                                <h:outputText value="#{prestador.nome}" />
                            </p:column>
                            <p:column headerText="Telefone">
                                <h:outputText value="#{prestador.telefone}" />
                            </p:column>
                            <p:column style="width:32px;text-align: center">
                                <p:commandButton title="Excluir" icon="ui-icon-trash"
                                                 onclick="confirmarExcluirPrestador.show()" ajax="true"  >
                                    <f:setPropertyActionListener value="#{prestador}"
                                                                 target="#{clienteFinalBean.prestadorSelecionado}" />
                                </p:commandButton>

                            </p:column>
                        </p:dataTable>
                        <p:commandButton title="Adicionar novo Prestador"
                                         icon="ui-icon-plus" onclick="alterarPrestador.show()" ajax="true" rendered="#{not empty clienteFinalBean.listaPrestadoresDisponiveis}"/>
                    </p:outputPanel>
                </p:panel>

            </h:form> 

            <script type="text/javascript">
                function handleDrop(event, ui) {
                    var droppedPrestador = ui.draggable;

                    droppedPrestador.fadeOut('fast');
                }
            </script>


            <p:dialog header="Associar Usuário à Prestadores de Socorro"
                      widgetVar="alterarPrestador" modal="true" showEffect="fade"
                      hideEffect="fade" resizable="false" closable="false" >



                <h:form id="formDragAndDropPrestador">
                    <p:fieldset id="campoPrestadoresDisponiveis" legend="Prestadores de Socorro Disponiveis">
                        <p:dataTable id="prestadoresDisponiveis" var="prestador" value="#{clienteFinalBean.listaPrestadoresDisponiveis}">
                            <p:column style="width:20px">
                                <h:outputText id="dragIconPrestador" styleClass="ui-icon ui-icon-arrow-4" />
                                <p:draggable for="dragIconPrestador" revert="true" helper="clone"/>
                            </p:column>

                            <p:column headerText="Id">
                                <h:outputText value="#{prestador.idPrestadorSocorro}" />
                            </p:column>

                            <p:column headerText="Nome">
                                <h:outputText value="#{prestador.nome}" />
                            </p:column>

                            <p:column headerText="Telefone">
                                <h:outputText value="#{prestador.telefone}" />
                            </p:column>

                        </p:dataTable>
                    </p:fieldset>

                    <p:fieldset id="prestadoresSelecionados" legend="Prestdadores de Socorro Selecionados" style="margin-top:20px">
                        <p:outputPanel id="dropAreaPrestador">
                            <h:outputText value="!!!Solte aqui!!!" rendered="#{empty clienteFinalBean.listaPrestadoresSelecionados}" style="font-size:24px;" />
                            <p:dataTable id="pulseirasSelecionadasTabela" var="pulseira" value="#{clienteFinalBean.listaPrestadoresSelecionados}" rendered="#{not empty clienteFinalBean.listaPrestadoresSelecionados}">
                                <p:column headerText="Id">
                                    <h:outputText value="#{prestador.idPrestadorSocorro}" />
                                </p:column>

                                <p:column headerText="Nome">
                                    <h:outputText value="#{prestador.nome}" />
                                </p:column>

                                <p:column headerText="Telefone">
                                    <h:outputText value="#{prestador.telefone}" />
                                </p:column>

                            </p:dataTable>
                        </p:outputPanel>
                    </p:fieldset>

                    <p:droppable for="prestadoresSelecionados" tolerance="touch" activeStyleClass="ui-state-highlight" datasource="prestadoresDisponiveis" onDrop="handleDrop">
                        <p:ajax listener="#{clienteFinalBean.onPrestadorDrop}" update="dropAreaPrestador prestadoresDisponiveis" />
                    </p:droppable>


                    <p:commandButton title="Salvar" value="Associar Prestadores de Socorro Selecionados"
                                     oncomplete="alterarPrestador.hide();"
                                     actionListener="#{clienteFinalBean.associarPrestador}"
                                     update=":formUsuario:growl :formPulseira :formDragAndDropPrestador" ajax="false" />
                    <p:commandButton title="Cancelar" value="Cancelar associação"
                                     oncomplete="alterarPrestador.hide();"
                                     actionListener="#{clienteFinalBean.preparaDialogPrestadores}"
                                     update=":formUsuario:growl :formPulseira :formDragAndDropPrestador"   ajax="false" />

                </h:form> 
            </p:dialog>  



        </p:panel>











        <h:form id="excluirUsuario">
            <p:confirmDialog
                message="Deseja realmente excluir este Usuário? Esta ação não poderá ser desfeita."
                hideEffect="explode" header="Aviso" severity="alert"
                widgetVar="confirmarExcluirUsuario">
                <p:commandButton id="btnSim" value="Sim"
                                 actionListener="#{clienteFinalBean.excluirUsuario}"
                                 oncomplete="confirmarExcluirUsuario.hide();" />
                <p:commandButton id="btnNao" value="Não"
                                 onclick="confirmarExcluirUsuario.hide()" type="button" />
            </p:confirmDialog>
        </h:form>

        <h:form id="excluirPrestador">
            <p:confirmDialog
                message="Deseja realmente desassociar este Prestador de Socorro?"
                hideEffect="explode" header="Aviso" severity="alert"
                widgetVar="confirmarExcluirPrestador">
                <p:commandButton id="btnSim" value="Sim"
                                 actionListener="#{clienteFinalBean.desassociarPrestador}"
                                 oncomplete="confirmarExcluirPrestador.hide();" />
                <p:commandButton id="btnNao" value="Não"
                                 onclick="confirmarExcluirPrestador.hide()" type="button" />
            </p:confirmDialog>
        </h:form>
        <h:form id="excluirPulseira">
            <p:confirmDialog
                message="Deseja realmente desassociar esta Pulseira? A pulseira estará livre para ser utilizada em outros usuários."
                hideEffect="explode" header="Aviso" severity="alert"
                widgetVar="confirmarExcluirPulseira">
                <p:commandButton id="btnSim" value="Sim"
                                 actionListener="#{clienteFinalBean.desassociarPulseira}"
                                 oncomplete="confirmarExcluirPulseira.hide();" ajax="true"/>
                <p:commandButton id="btnNao" value="Não"
                                 onclick="confirmarExcluirPulseira.hide()" type="button" />
            </p:confirmDialog>
        </h:form>

        <ui:insert name="footer" > 
            <ui:include src="subtemplate/_footer.xhtml" />
        </ui:insert>
    </h:body>

    <ui:insert name="commonFooter" >
        <ui:include src="subtemplate/_commonFooter.xhtml" />
    </ui:insert>

    <script type="text/javascript" src="js/jquery.quick.search.js"></script>
</html>